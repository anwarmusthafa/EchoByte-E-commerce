{% extends 'base.html' %}
{% load static %}
{% block title%}Orders {% endblock %}
{% block content %}


        <!--====== App Content ======-->
        <div class="app-content">

            <!--====== Section 1 ======-->
          




            <!--====== Section 2 ======-->
            <div class="u-s-p-b-60"> <br>

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="dash">
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-3 col-md-12">

                                    <!--====== Dashboard Features ======-->
                                    {% include 'profile-side-bar.html' %}
                                    
                                    <!--====== End - Dashboard Features ======-->
                                </div>
                                <div class="col-lg-9 col-md-12">
                                    <h1 class="dash__h1 u-s-m-b-30">Order Details</h1>
                                    <div class="dash__box dash__box--shadow dash__box--radius dash__box--bg-white u-s-m-b-30">
                                        <div class="dash__pad-2">
                                            <div class="dash-l-r">
                                                <div>
                                                    <div class="manage-o__text-2 u-c-secondary">Order id {{order.pk}}</div>
                                                    <div class="manage-o__text u-c-silver">Placed on {{order.created_at}}</div>
                                                </div>
                                                <div>
                                                    <div class="manage-o__text-2 u-c-silver">Total:

                                                        <span class="manage-o__text-2 u-c-secondary">{{order.amount}}</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="dash__box dash__box--shadow dash__box--radius dash__box--bg-white u-s-m-b-30">
                                        <div class="dash__pad-2">
                                            <div class="manage-o">
                                                <div class="manage-o__header u-s-m-b-30">
                                                    <div class="manage-o__icon"><i class="fas fa-box u-s-m-r-5"></i>

                                                        <span class="manage-o__text">Package 1</span></div>
                                                </div>
                                                <div class="dash-l-r">
                                                    <div class="manage-o__text u-c-secondary">Delivered on 26 Oct 2016</div>
                                                    <div class="manage-o__icon"><i class="fas fa-truck u-s-m-r-5"></i>

                                                        <span class="manage-o__text">Standard</span></div>
                                                </div>
                                                {% if order.order_status == -1 %}
                                                <div class="alert alert-danger col-4 mx-auto" role="alert">
                                                    <h2 class="text-center">Order Cancelled</h2>
                                                </div>
                                            {% elif order.order_status == -2 %}
                                                <div class="alert alert-danger col-4 mx-auto" role="alert">
                                                    <h2 class="text-center">Seller Cancelled Order</h2>
                                                </div>
                                                {% elif order.order_status == 4 %}
                                                <div class="alert alert-danger col-4 mx-auto" role="alert">
                                                    <h2 class="text-center">Return Requested</h2>
                                                </div>
                                                {% elif order.order_status == 5 %}
                                                <div class="alert alert-danger col-4 mx-auto" role="alert">
                                                    <h2 class="text-center">Returned</h2>
                                                </div>
                                            {% else %}
                                                 


                                                <div class="manage-o__timeline">

                                                    <div class="timeline-row">
                                                        <div class="col-lg-4 u-s-m-b-30">
                                                            <div class="timeline-step" id="processingStep">
                                                                <div class="timeline-l-i">
                                                                    <span class="timeline-circle"></span>
                                                                </div>
                                                                <span class="timeline-text">Processing</span>
                                                            </div>
                                                        </div>

                                                        <div class="col-lg-4 u-s-m-b-30">
                                                            <div class="timeline-step" id="shippedStep">
                                                                <div class="timeline-l-i">
                                                                    <span class="timeline-circle"></span>
                                                                </div>
                                                                <span class="timeline-text">Shipped</span>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-4 u-s-m-b-30">
                                                            <div class="timeline-step" id="deliveredStep">
                                                                <div class="timeline-l-i">
                                                                    <span class="timeline-circle"></span>
                                                                </div>
                                                                <span class="timeline-text">Delivered</span>
                                                            </div>
                                                        </div>
                                                        
                                                    </div>

                                                </div>
                                                {% endif %}


                                                <div class="manage-o__description">
                                                    <div class="description__container">
                                                        <div class="description__img-wrap">

                                                            <img class="u-img-fluid" src="{{ order.product.product.images.first.image.url }}" alt=""></div>
                                                        <div class="description-title">{{order.product.product.brand}} {{order.product.product.title}} ({{order.product.variant_name}})</div>
                                                    </div>
                                                    <div class="description__info-wrap">
                                                        <div>

                                                            <span class="manage-o__text-2 u-c-silver">Quantity:

                                                                <span class="manage-o__text-2 u-c-secondary">{{order.quantity}}</span></span></div>
                                                        <div>

                                                            <span class="manage-o__text-2 u-c-silver">Total:

                                                                <span class="manage-o__text-2 u-c-secondary">{{order.amount}}</span></span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center u-s-m-b-30">
                                        {% if order.is_paid == False %} 
                                        <a href="">
                                            <button class="btn btn-success">Make Payment</button>
                                        </a>
                                        {% endif %}
                                        {% if order.order_status > 0 and order.order_status < 3 %}
                                            <a href="{% url 'cancel_order' order.pk %}">
                                                <button class="btn btn-danger">Cancel Order</button>
                                            </a>
                                        {% elif order.order_status == 3 %}
                                            <a href="{% url 'return_order' order.pk %}">
                                                <button class="btn btn-primary">Return Order</button>
                                            </a>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="dash__box dash__box--bg-white dash__box--shadow u-s-m-b-30">
                                                <div class="dash__pad-3">
                                                    <h2 class="dash__h2 u-s-m-b-8">Shipping Address</h2>
                                                    <h2 class="dash__h2 u-s-m-b-8">{{order.address.name}}</h2>

                                                    <span class="dash__text-2">{{order.address.address}}</span>

                                                    <span class="dash__text-2">{{order.address.phone}}</span>
                                                </div>
                                            </div>
                                            
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="dash__box dash__box--bg-white dash__box--shadow u-h-100">
                                                <div class="dash__pad-3">
                                                    <h2 class="dash__h2 u-s-m-b-8">Total Summary</h2>
                                                    <div class="dash-l-r u-s-m-b-8">
                                                        <div class="manage-o__text-2 u-c-secondary">Subtotal</div>
                                                        <div class="manage-o__text-2 u-c-secondary">₹{{order.amount}}</div>
                                                    </div>
                                                    <div class="dash-l-r u-s-m-b-8">
                                                        <div class="manage-o__text-2 u-c-secondary">Shipping Fee</div>
                                                        <div class="manage-o__text-2 u-c-secondary">₹0.00</div>
                                                    </div>
                                                    <div class="dash-l-r u-s-m-b-8">
                                                        <div class="manage-o__text-2 u-c-secondary">Total</div>
                                                        <div class="manage-o__text-2 u-c-secondary">₹{{order.amount}}</div>
                                                    </div>

                                                    <span class="dash__text-2">Paid by {{order.payment_method}}</span>
                                                </div>
                                                {% if order.order_status > 2 %}
                                                <div class="col-auto">
                                                    <!-- Button with the btn-success class -->
                                                    <a href="{% url "download_invoice" order.id%}"><button class="btn btn-success">Download Invoice</button></a>
                                                </div>
                                                {% endif %}

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 2 ======-->
        </div>
        <!--====== End - App Content ======-->


        <script>
            // Function to update the status of the timeline steps
            function updateTimeline(status) {
                // Reset all steps to initial state
                document.querySelectorAll('.timeline-l-i').forEach(function(step) {
                    step.classList.remove('timeline-l-i--finish');
                });
        
                // Update steps based on the current status
                if (status === 'processing') {
                    document.getElementById('processingStep').querySelector('.timeline-l-i').classList.add('timeline-l-i--finish');
                } else if (status === 'shipped') {
                    document.getElementById('processingStep').querySelector('.timeline-l-i').classList.add('timeline-l-i--finish');
                    document.getElementById('shippedStep').querySelector('.timeline-l-i').classList.add('timeline-l-i--finish');
                } else if (status === 'delivered') {
                    document.getElementById('processingStep').querySelector('.timeline-l-i').classList.add('timeline-l-i--finish');
                    document.getElementById('shippedStep').querySelector('.timeline-l-i').classList.add('timeline-l-i--finish');
                    document.getElementById('deliveredStep').querySelector('.timeline-l-i').classList.add('timeline-l-i--finish');
                }
            }
        
            // Example usage
            // Call updateTimeline function with appropriate status: processing, shipped, or delivered
            // For example:
            {% if order.order_status == 1 %} updateTimeline('processing');{% endif %}
            {% if order.order_status == 2 %} updateTimeline('shipped');{% endif %}
            {% if order.order_status == 3 %} updateTimeline('delivered');{% endif %}
            
            
        </script>
        


     
{% endblock %}