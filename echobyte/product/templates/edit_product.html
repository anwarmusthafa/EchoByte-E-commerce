{% extends "admin_base.html" %}
{% block content %}
{% if error_message %}
    <div class="alert alert-danger" role="alert">
        {{ error_message }}
    </div>
{% endif %}
{% if success_message %}
    <div class="alert alert-success" role="alert">
        {{ success_message }}
    </div>
{% endif %}
<div class="col-12 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title">Edit Product</h4>
        {% if product %}
        <form class="forms-sample" method="post" action="{% url 'edit_product' product.pk %}"  enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
              <label for="exampleFormControlSelect1">Brand</label>
              <select required name="brand" class="form-control form-control-lg" id="exampleFormControlSelect1">
                  <option value="" disabled {% if not product.brand %}selected{% endif %}>Choose...</option>
                  {% for brand in existing_brands %}
                      <option value="{{ brand.id }}" {% if product.brand.id == brand.id %}selected{% endif %}>
                          {{ brand.brand }}
                      </option>
                  {% endfor %}
              </select>
          </div>
              <div class="form-group">
                      <label for="exampleFormControlSelect1">Category</label>
                      <select name="category" required class="form-control form-control-lg" id="exampleFormControlSelect1">
                          <option value="" disabled {% if not product.category %}selected{% endif %}>Choose...</option>
                          {% for category in categories %}
                              <option value="{{ product.category }}" {% if product.category == category %}selected{% endif %}>
                                  {{ category }}
                              </option>
                          {% endfor %}
                      </select>
                  </div>

         <div class="form-group">
            <label for="exampleInputEmail3">Title</label>
            <input required name="title" value="{{product.title}}" type="text" class="form-control" id="exampleInputEmail3" placeholder="Title">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail3">Processor</label>
            <input required value="{{product.processor}}" name="processor" type="text" class="form-control" id="exampleInputEmail3" placeholder="Processor">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail3">Display</label>
            <input required value="{{product.display}}" name="display" type="text" class="form-control" id="exampleInputEmail3" placeholder="Display">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail3">Front Camera</label>
            <input name="front-camera" value={{product.front_camera}} type="text" class="form-control" id="exampleInputEmail3" placeholder="Front Camera">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail3">Back Camera</label>
            <input  name="back-camera" value="{{product.back_camera}}" type="text" class="form-control" id="exampleInputEmail3" placeholder="Back Camera">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail3">Priority</label>
            <input  name="priority" value="{{product.priority}}" type="number" class="form-control" id="exampleInputEmail3" placeholder="Priority">
          </div>
          <!-- <div class="form-group">
            <label>File upload</label>
            <input type="file" name="img[]" class="file-upload-default">
            <div class="input-group col-xs-12">
              <input type="text" class="form-control file-upload-info" disabled placeholder="Upload Image">
              <span class="input-group-append">
                <button class="file-upload-browse btn btn-gradient-primary" type="button">Upload</button>
              </span>
            </div>
          </div> -->
          <div class="form-group">
            <label for="exampleInputCity1">Battery</label>
            <input name="battery" type="text" value="{{product.battery_capacity}}" class="form-control" id="exampleInputCity1" placeholder="Battery">
          </div>
          <div class="form-group">
            <label  for="exampleTextarea1">Description</label>
            <textarea value="" required  class="form-control" name="description" placeholder="Description" id="exampleTextarea1" rows="4">{{product.description}}</textarea>
          </div>
          {% if images %}
  {% for image in images %}
    <div class="form-group">
      <label for="">Image {{ image.image_order }}</label>
      <input name="image-{{ image.image_order }}" style="padding: 5px;" type='file' onchange="handleImageChange(this, 'blah{{ image.image_order }}', 'removeButton{{ image.image_order }}');" />
      <img style="max-width: 100px;" id="blah{{ image.image_order }}" src="{{ image.image.url }}" alt="your image" />
      <button type="button" class="remove-button" id="removeButton{{ image.image_order }}" onclick="removeImage('blah{{ image.image_order }}', 'removeButton{{ image.image_order }}')">Remove</button>
    </div>
  {% endfor %}
{% else %}
  {% for i in 1..5 %}
    <div class="form-group">
      <label for="">Image {{ i }}</label>
      <input name="image-{{ i }}" style="padding: 5px;" type='file' onchange="handleImageChange(this, 'blah{{ i }}', 'removeButton{{ i }}');" />
      <img style="max-width: 100px;" id="blah{{ i }}" src="" alt="your image" />
      <button type="button" class="remove-button" id="removeButton{{ i }}" style="display: none;" onclick="removeImage('blah{{ i }}', 'removeButton{{ i }}')">Remove</button>
    </div>
  {% endfor %}
{% endif %}
          
          <button type="submit" class="btn btn-gradient-primary me-2">Submit</button>
          <button class="btn btn-light">Cancel</button>
        </form>
        {% endif %}
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script>
      function readURL(input, imageId) {
          if (input.files && input.files[0]) {
              var reader = new FileReader();
  
              reader.onload = function (e) {
                  $('#' + imageId).attr('src', e.target.result);
              };
  
              reader.readAsDataURL(input.files[0]);
          }
      }

      function handleImageChange(input, imageId, removeButtonId) {
        var imageElement = document.getElementById(imageId);
        var removeButton = document.getElementById(removeButtonId);
    
        if (input.files && input.files[0]) {
          var reader = new FileReader();
    
          reader.onload = function (e) {
            imageElement.src = e.target.result;
            removeButton.style.display = 'inline-block'; // Display remove button when an image is selected
          };
    
          reader.readAsDataURL(input.files[0]);
        }
      }
    
      function removeImage(imageId, removeButtonId) {
        var imageElement = document.getElementById(imageId);
        var removeButton = document.getElementById(removeButtonId);
    
        // Reset the image source and hide the remove button
        imageElement.src = '';
        removeButton.style.display = 'none';
    
        // You might also want to clear the corresponding file input
        var inputElement = document.querySelector('[name="' + imageId.replace('blah', 'image') + '"]');
        inputElement.value = '';
    
        // If you want to perform additional actions when removing an image, you can add them here.
      }
  </script>
  {% endblock content %}